<Window x:Class="PathFinder.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:pf="clr-namespace:PathFinder"
        Title="PathFinder" Height="600" Width="800"
        x:Name="view">
    <Window.Resources>
        <pf:RadioIsCheckedConverter x:Key="RadioIsChecked"></pf:RadioIsCheckedConverter>
        <pf:NodeIdxToCoord x:Key="NodeIdxToCoord"></pf:NodeIdxToCoord>
    </Window.Resources>
    <DockPanel>
        <DockPanel DockPanel.Dock="Right" Background="White" Panel.ZIndex="99">

            <GroupBox Header="Grid Controls" DockPanel.Dock="Bottom">
                <StackPanel Orientation="Vertical">
                    <Button Content="Clear Walls" Command="{Binding ClearWallsCommand}" />
                    <Button Content="Clear Path" Command="{Binding ClearPathCommand}" />
                    <Button Content="Generate Maze"/>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="Playback Controls" DockPanel.Dock="Bottom">
                <StackPanel Orientation="Vertical">
                    <Button Content="Start" />
                    <Button Content="Pause" />
                    <Button Content="Stop" />
                </StackPanel>
            </GroupBox>

            <GroupBox Header="Search Options">
                <StackPanel Orientation="Vertical">
                    <GroupBox Header="Algorithm">
                        <StackPanel Orientation="Vertical">
                            <RadioButton IsChecked="{Binding Algorithm, 
								Converter={StaticResource RadioIsChecked}, 
								ConverterParameter={x:Static pf:AlgorithmType.AStar}}">
                                A-Star
                            </RadioButton>
                            <RadioButton IsChecked="{Binding Algorithm, 
								Converter={StaticResource RadioIsChecked}, 
								ConverterParameter={x:Static pf:AlgorithmType.BreadthFirst}}">
                                Breadth-First
                            </RadioButton>
                            <RadioButton IsChecked="{Binding Algorithm, 
								Converter={StaticResource RadioIsChecked}, 
								ConverterParameter={x:Static pf:AlgorithmType.DepthFirst}}">
                                Depth-First
                            </RadioButton>
                            <RadioButton IsChecked="{Binding Algorithm, 
								Converter={StaticResource RadioIsChecked},
								ConverterParameter={x:Static pf:AlgorithmType.HillClimbing}}">
                                Hill Climbing
                            </RadioButton>
                            <RadioButton IsChecked="{Binding Algorithm, 
								Converter={StaticResource RadioIsChecked}, 
								ConverterParameter={x:Static pf:AlgorithmType.BestFirst}}">
                                Best-First
                            </RadioButton>
                            <RadioButton IsChecked="{Binding Algorithm, 
								Converter={StaticResource RadioIsChecked}, 
								ConverterParameter={x:Static pf:AlgorithmType.Dijkstra}}">
                                Dijkstra
                            </RadioButton>
                            <RadioButton IsChecked="{Binding Algorithm, 
								Converter={StaticResource RadioIsChecked}, 
								ConverterParameter={x:Static pf:AlgorithmType.JumpPoint}}">
                                Jump Point Search
                            </RadioButton>
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Heuristic Function">
                        <StackPanel Orientation="Vertical">
                            <RadioButton IsChecked="{Binding HeuristicFunction, 
								Converter={StaticResource RadioIsChecked},
								ConverterParameter={x:Static pf:Heuristic.Manhattan}}">
                                Manhattan
                            </RadioButton>
                            <RadioButton IsChecked="{Binding HeuristicFunction, 
								Converter={StaticResource RadioIsChecked}, 
								ConverterParameter={x:Static pf:Heuristic.Euclidean}}">
                                Euclidean
                            </RadioButton>
                            <RadioButton IsChecked="{Binding HeuristicFunction, 
								Converter={StaticResource RadioIsChecked}, 
								ConverterParameter={x:Static pf:Heuristic.Chebyshev}}">
                                Chebyshev
                            </RadioButton>
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Optional Settings">
                        <StackPanel Orientation="Vertical">
                            <CheckBox Name="DiagBox">Diagonals Allowed</CheckBox>
                            <CheckBox IsEnabled="{Binding ElementName=DiagBox, Path=IsChecked}">
                                Corner Crossing Allowed</CheckBox>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </GroupBox>
        </DockPanel>

        <!-- Canvas to display all dynamic elements -->
        <ItemsControl  Name="ItemsCanvas" Padding="0">
            <ItemsControl.Resources>
                <!-- Combine all lists into one -->
                <CompositeCollection x:Key="Col">
                    <CollectionContainer Collection="{Binding DataContext.Grid.Nodes,Source={x:Reference view}}" />
                </CompositeCollection>

                <!--Template for Node-->
                <DataTemplate DataType="{x:Type pf:Node}">
                    <Rectangle Stroke="#CC000000" StrokeThickness="0.25"
                               RenderTransformOrigin="0.5,0.5"
                               Width="{x:Static pf:Node.Nodesize}"
                               Height="{x:Static pf:Node.Nodesize}"
                               Name="nodeRect" Fill="White">
                        <Rectangle.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1" />
                        </Rectangle.RenderTransform>
                    </Rectangle>

                    <DataTemplate.Triggers>
                        <!--Node triggers to colorize based on current state-->
                        <DataTrigger Binding="{Binding State}" Value="{x:Static pf:NodeState.Start}">
                            <Setter TargetName="nodeRect" Property="Fill" Value="#00FF00"></Setter>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding State}" Value="{x:Static pf:NodeState.End}">
                            <Setter TargetName="nodeRect" Property="Fill" Value="Red"></Setter>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding State}" Value="{x:Static pf:NodeState.Open}">
                            <Setter TargetName="nodeRect" Property="Fill" Value="Orange"></Setter>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding State}" Value="{x:Static pf:NodeState.Closed}">
                            <Setter TargetName="nodeRect" Property="Fill" Value="Cyan"></Setter>
                        </DataTrigger>

                        <!--The wall trigger has a nice transition animation-->
                        <DataTrigger Binding="{Binding State}" Value="{x:Static pf:NodeState.Wall}">
                            <DataTrigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <ColorAnimation Storyboard.TargetName="nodeRect" Storyboard.TargetProperty="Fill.Color" To="Gray" Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="nodeRect" Storyboard.TargetProperty="RenderTransform.ScaleX" To="1.2" Duration="0:0:0.1" AutoReverse="True" />
                                        <DoubleAnimation Storyboard.TargetName="nodeRect" Storyboard.TargetProperty="RenderTransform.ScaleY" To="1.2" Duration="0:0:0.1" AutoReverse="True" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.EnterActions>

                            <DataTrigger.ExitActions>
                                <!--The only time you ever exit a wall state is to go to an empty state, so make that switch here-->
                                <BeginStoryboard>
                                    <Storyboard>
                                        <ColorAnimation Storyboard.TargetName="nodeRect" Storyboard.TargetProperty="Fill.Color" To="White" Duration="0:0:0.1"/>
                                        <DoubleAnimation Storyboard.TargetName="nodeRect" Storyboard.TargetProperty="RenderTransform.ScaleX" To="1.2" Duration="0:0:0.1" AutoReverse="True" />
                                        <DoubleAnimation Storyboard.TargetName="nodeRect" Storyboard.TargetProperty="RenderTransform.ScaleY" To="1.2" Duration="0:0:0.1" AutoReverse="True" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </DataTrigger.ExitActions>
                        </DataTrigger>
                    </DataTemplate.Triggers>
                </DataTemplate>
            </ItemsControl.Resources>

            <ItemsControl.ItemsSource>
                <StaticResource ResourceKey="Col" />
            </ItemsControl.ItemsSource>

            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas IsItemsHost="True" Background="White"
                            Width="{Binding ElementName=ItemsCanvas, Path=ActualWidth}"
                            Height="{Binding ElementName=ItemsCanvas, Path=ActualHeight}"
                            VerticalAlignment="Top" HorizontalAlignment="Left" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemContainerStyle>
                <Style TargetType="ContentPresenter">
                    <Setter Property="Canvas.Left" Value="{Binding X, Converter={StaticResource NodeIdxToCoord}}" />
                    <Setter Property="Canvas.Top" Value="{Binding Y, Converter={StaticResource NodeIdxToCoord}}" />

                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Panel.ZIndex" Value="99"></Setter>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </ItemsControl.ItemContainerStyle>
        </ItemsControl>
    </DockPanel>
</Window>
